function openModal(e){const a=modal.classList,t=modal_overlay;e?(t.classList.remove("hidden"),setTimeout(()=>{a.remove("opacity-0"),a.remove("-translate-y-full"),a.remove("scale-150")},100)):(a.add("-translate-y-full"),setTimeout(()=>{a.add("opacity-0"),a.add("scale-150")},100),setTimeout(()=>t.classList.add("hidden"),300))}const modal_overlay=document.querySelector("#modal_overlay"),modal=document.querySelector("#modal");let player1Images={},player2Images={},maxMovement=15;const canvas=new fabric.Canvas("mainCanvas",{backgroundImage:"images/background.jpg",width:window.innerWidth,height:.94*window.innerHeight});let playerHeight=Math.ceil(canvas.height/1.5),playerWidth=Math.ceil(canvas.width/2.5),player1Position=new fabric.Point(playerWidth/2.7,canvas.height-playerHeight/2),player2Position=new fabric.Point(canvas.width-playerWidth/2.7,canvas.height-playerHeight/2),xMin=new fabric.Point(playerWidth/2.7,canvas.height-playerHeight/2),xMax=new fabric.Point(canvas.width-playerWidth/2.7,canvas.height-playerHeight/2);const imgPath=(e="",a=!1,t="png")=>a?`./images/${a}/${e}.${t}`:`./images/${e}.${t}`,loadAllImages=e=>{const a={backward:[1,2,3,4,5,6],block:[1,2,3,4,5,6,7,8,9],forward:[1,2,3,4,5,6],idle:[1,2,3,4,5,6,7,8],kick:[1,2,3,4,5,6,7],punch:[1,2,3,4,5,6,7]};for(const t in a)player1Images[t]=[],player2Images[t]=[],a[t].forEach(a=>{fabric.Image.fromURL(imgPath(a,t),i=>{i.scaleToHeight(playerHeight),i.scaleToWidth(playerWidth),player1Images[t].push(i),i.clone(e=>{e.set({flipX:!0}),player2Images[t].push(e)}),"punch"===t&&7===a&&e()})})};let calculateMovePixels=(e=player1Position.x,a=!0,t=6,i=120)=>a?(e+120>xMax.x?xMax.x-e:i)/t:(e-120<xMin.x?-(e-xMin.x):-i)/t;const animate=(e=canvas,a="idle",t="idle",i)=>{let s=100*Math.max(player1Images[a].length,player2Images[t].length),l=s/player1Images[a].length,r=s/player2Images[t].length;if("forward"!==a&&"backward"!==a)player1Images[a].forEach((a,t)=>{setTimeout(()=>{e.item(0).setElement(a.getElement()),e.item(0).setPositionByOrigin(player1Position),e.renderAll()},t*l)});else{let t="forward"===a?calculateMovePixels(player1Position.x):calculateMovePixels(player1Position.x,!1);player1Images[a].forEach((a,i)=>{setTimeout(()=>{e.item(0).setElement(a.getElement()),e.item(0).setPositionByOrigin(player1Position.addEquals(new fabric.Point(t,0))),e.renderAll()},i*l)})}if("forward"!==t&&"backward"!==t)player2Images[t].forEach((a,t)=>{setTimeout(()=>{e.item(1).setElement(a.getElement()),e.item(1).setPositionByOrigin(player2Position),e.renderAll()},t*r)});else{let a="forward"===t?calculateMovePixels(player2Position.x,!1):calculateMovePixels(player2Position.x);player2Images[t].forEach((t,i)=>{setTimeout(()=>{e.item(1).setElement(t.getElement()),e.item(1).setPositionByOrigin(player2Position.addEquals(new fabric.Point(a,0))),e.renderAll()},i*r)})}setTimeout(i,s)};let startGame=()=>{openModal(!0),canvas.hoverCursor="default",canvas.add(player1Images.idle[0]),canvas.item(0).hasControls=canvas.item(0).hasBorders=canvas.item(0).selectable=!1,canvas.item(0).setPositionByOrigin(player1Position),canvas.add(player2Images.idle[0]),canvas.item(1).hasControls=canvas.item(1).hasBorders=canvas.item(1).selectable=!1,canvas.item(1).setPositionByOrigin(player2Position),canvas.renderAll();let e=[],a=[],t=()=>{let i=e.length?e.shift():"idle",s=a.length?a.shift():"idle";animate(canvas,i,s,t)};window.addEventListener("keydown",t=>{switch(t.key){case"k":case"K":e.push("kick");break;case"p":case"P":e.push("punch");break;case"b":case"B":e.push("block");break;case"a":case"A":e.push("backward");break;case"d":case"D":e.push("forward");break;case"7":a.push("kick");break;case"9":a.push("punch");break;case"4":a.push("block");break;case"ArrowRight":a.push("backward");break;case"ArrowLeft":a.push("forward")}}),t()};loadAllImages(startGame);